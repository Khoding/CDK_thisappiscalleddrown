{% extends 'base.html' %}
{% load widget_tweaks %}
{% load extras %}
{% load static %}

{% block head %}
    <script src="{% static 'koolapic/js/group_details.js' %}" type="module"></script>
    <script src="{% static 'koolapic/js/tabs.js' %}"></script>
    <script src="{% static 'koolapic/js/activities.js' %}" crossorigin="anonymous" type="module"></script>
{% endblock %}

{% block content %}
    <div class="group-header gradient-l2 small-padding-container rounded-corner-container text-white">
        {% if group.image %}<img src="{{ group.image.url }}" alt="Bannière du groupe" class="group-banner">{% endif %}
        <div class="group-panel small-padding-container">
            <h1>{{ group.name }}</h1>
            <div id="groupOverview" class="group-members-overview d-none d-lg-block">
                <div class="members-overview mb-2">
                    {% for user_p in all_members|slice:"10" %}
                        {% include 'includes/profile_picture.html' %}
                    {% empty %}
                        <h1 class="empty">Aucun membre n'est présent dans ce groupe.</h1>
                    {% endfor %}

                    {% if members.count > 10 %}
                        <a href="#membersList" data-toggle="tab" role="link" aria-controls="link" class="undisplayed-elements-badge">+ {{ undisplayed_members_count }}</a>
                    {% endif %}
                </div>

                {% if group.invitation_policy == "PU" and user not in members and user not in admins %}
                    <button id="joinButton" type="button" class="btn btn-secondary" onclick="join();">Rejoindre</button>
                {% endif %}

                {% if user in members %}
                    <button id="leaveButton" type="button" class="btn btn-secondary" onclick="leave();">Quitter</button>
                {% endif %}

                {% if user in all_members %}
                    {% if group.invitation_policy == "PU" or group.invitation_policy == "OI" %}
                        <button id="inviteButton" type="button" class="btn btn-secondary" data-toggle="modal" data-target="#invitationModal">Inviter quelqu'un</button>
                    {% elif user in admins and group.invitation_policy == "OAI" %}
                        <button id="inviteButton" type="button" class="btn btn-secondary" data-toggle="modal" data-target="#invitationModal">Inviter quelqu'un</button>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        <ul class="nav nav-tabs group-nav">
            <li class="nav-item">
                <a class="nav-link active" data-toggle="tab" id="aboutTab" href="#about" role="tab" data-controls="about" aria-controls="about">A propos</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="membersTab" href="#members" role="tab" data-controls="members" aria-controls="members">Membres</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="managementTab" href="#management" role="tab" data-controls="management" aria-controls="management">Gestion</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" id="activitiesTab" href="#activities" role="tab" data-controls="activities" aria-controls="activities">Activités</a>
            </li>
        </ul>
        <div class="tab-content medium-padding-container">
            <div class="tab-pane active" id="about" role="tabpanel" aria-labelledby="aboutTab">
                {% include 'koolapic/groups/includes/about_group.html' %}
            </div>
            <div class="tab-pane" id="members" role="tabpanel" aria-labelledby="membersTab">
                {% include 'koolapic/groups/includes/group_members.html' %}
            </div>
            <div class="tab-pane" id="activities" role="tabpanel" aria-labelledby="activitiesTab">
                {% include 'koolapic/groups/includes/group_activities.html' %}
            </div>
            <div class="tab-pane" id="management" role="tabpanel" aria-labelledby="optionsTab">
                <h1>Options</h1>
            </div>
        </div>
    </div>
    <div id="invitationModal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Inviter quelqu'un sur {{ group.name }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="invitationForm">
                        {% csrf_token %}
                        <h5>Invitation directe</h5>
                        {{ invitation_form.email.label_tag }}
                        <div class="input-group">
                            {{ invitation_form.email|add_class:"form-control" }}
                            <button class="btn btn-primary input-group-append" type="button" onclick="sendInvite();">Inviter</button>
                        </div>
                        <hr>
                        <h5><label for="invitationLink" class="label">Lien d'invitation</label></h5>

                        <div class="input-group">
                            <input type="text" class="form-control disabled" name="invitationLink" id="invitationLink" disabled aria-disabled="true">
                            <div class="input-group-append">
                                <button id="copyInvitationLinkButton" class="popover-btn btn btn-primary" type="button" onclick="copyLink();" data-template="copyInvitationLinkTooltip"><i class="far fa-clipboard"></i></button>
                                <a id="shareInvitationLink" href="#" class="btn btn-primary" type="button" onclick=""><i class="fas fa-share"></i></a>
                            </div>
                        </div>
                        <div class="tooltip" id="copyInvitationLinkTooltip">
                            <strong>Lien copié dans le presse-papier</strong>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-primary" data-dismiss="modal">Annuler</button>

                </div>
            </div>
        </div>
    </div>

{% endblock content %}